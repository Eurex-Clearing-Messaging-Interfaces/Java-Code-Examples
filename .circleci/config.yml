version: 2
jobs:
  build:
    machine: true 
    steps:
      - checkout
#      - run: docker run -dh ecag-fixml-dev1 -p 35671:10000 -p 35672:20000 -p 40000:40000 -p 50000:22 --name=fixml vyboant/fixml_test
      - run: hostnamectl set-hostname ecag-fixml-dev1
      - run: hostname
#      - run: sleep 10 
#      - run: docker exec fixml java -jar /home/oper/sender.jar --host=ecag-fixml-dev1 --port=10000 --keystore-path=/home/oper/ABCFR_ABCFRALMMACC1.keystore --keystore-pass=12345678 --truststore-path=/home/oper/ecag-fixml-dev1.truststore --truststore-pass=12345678 --alias=abcfr_abcfralmmacc1 --node-name=request.ABCFR_ABCFRALMMACC1 --subject=# --ssl-debug=true
#      - run: mvn -P integration-test verify



#machine:
#  hosts:
#    ecag-fixml-dev1: 127.0.0.1
#  java:
#    version: oraclejdk8
#  services:
#    - docker
#
#test:
#  pre:
#    - docker run -d -p 35672:5672 -p 35671:5671 ecmi/fixml:sim
#  override:
#    - mvn -P integration-test verify
#  post:
#    - mkdir -p $CIRCLE_TEST_REPORTS/junit/
#    - find . -type f -regex ".*/target/failsafe-reports/.*xml" -exec cp {} $CIRCLE_TEST_REPORTS/junit/ \;
#    - mkdir -p $CIRCLE_ARTIFACTS/coverage/1.0/
#    - cp -r qpid-jms/target/site/jacoco/* $CIRCLE_ARTIFACTS/coverage/1.0/
#
 